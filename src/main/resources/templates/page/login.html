<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>登录 / 注册</title>

    <style>
      /* 基础样式重置 */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      /* 背景样式 */
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, rgba(240, 245, 255, 1) 0%, rgba(225, 230, 255, 1) 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        position: relative;
        color: #333344;
      }

      /* 动态网格背景 */
      body::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(rgba(140, 160, 255, 0.15) 1px, transparent 1px),
                          linear-gradient(90deg, rgba(140, 160, 255, 0.15) 1px, transparent 1px);
        background-size: 50px 50px;
        animation: gridMove 20s linear infinite;
        z-index: -1;
      }

      @keyframes gridMove {
        0% { transform: translate(0, 0) rotate(0deg); }
        100% { transform: translate(50px, 50px) rotate(360deg); }
      }

      /* 动态霓虹光效 */
      body::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(140, 160, 255, 0.15) 0%, transparent 50%);
        animation: neonPulse 4s ease-in-out infinite;
        z-index: -1;
      }

      @keyframes neonPulse {
        0%, 100% { transform: scale(1); opacity: 0.6; }
        50% { transform: scale(1.1); opacity: 0.9; }
      }

      /* 登录容器 */
      .login-container {
        width: 420px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border-radius: 16px;
        border: 1px solid rgba(140, 160, 255, 0.25);
        padding: 30px 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        max-height: 90vh;
        overflow-y: auto;
        z-index: 1;
      }

      h1 {
        text-align: center;
        margin-bottom: 25px;
        color: #333344;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .row {
        display: flex;
        gap: 20px;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        margin-bottom: 20px;
        border-radius: 8px;
        border: 1px solid rgba(140, 160, 255, 0.25);
        font-size: 15px;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.85);
        color: #333344;
        backdrop-filter: blur(5px);
      }

      input::placeholder,
      select::placeholder {
        color: rgba(51, 51, 68, 0.6);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: rgba(140, 160, 255, 0.8);
        box-shadow: 0 0 10px rgba(140, 160, 255, 0.3);
      }

      .submit-btn {
        width: 100%;
        margin-top: 25px;
        padding: 14px;
        background: linear-gradient(135deg, rgba(140, 160, 255, 0.9) 0%, rgba(160, 140, 255, 0.9) 100%);
        color: white;
        border: 1px solid rgba(140, 160, 255, 0.8);
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .submit-btn:hover {
        background: linear-gradient(135deg, rgba(160, 140, 255, 1) 0%, rgba(140, 160, 255, 1) 100%);
        box-shadow: 0 4px 15px rgba(140, 160, 255, 0.4);
        transform: translateY(-2px);
      }

      /* 动态选项样式 */
      .select-box {
        margin-top: 10px;
        padding: 12px;
        border: 1px solid #aaa;
        border-radius: 6px;
        cursor: pointer;
        background-color: #fafafa;
      }

      .club-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #aaa;
        padding: 10px;
        margin-top: 5px;
        border-radius: 6px;
        display: none;
        background-color: #fff;
      }

      .club-list label {
        display: block;
        margin: 5px 0;
      }
      .club-select-btn {
        width: 100%;
        padding: 14px;
        font-size: 15px;
        font-weight: 600;
        text-align: left;
        background-color: #f3f6fb;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.25s ease;
      }
      .club-select-btn:hover {
        background-color: #e8eef8;
        border-color: #94a3b8;
      }
      .club-list-container {
        margin-top: 8px;
        padding: 10px;

        border: 1px solid #d1d5db;
        border-radius: 8px;
        background-color: #ffffff;
        max-height: 220px;
        overflow-y: auto;
      }
      .club-item {
        display: flex;
        align-items: center;

        padding: 8px 10px;
        margin-bottom: 6px;

        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .club-item:hover {
        background-color: #f1f5f9;
      }
      .club-checkbox {
        transform: scale(1.2);
        margin-right: 10px;
      }
      .club-text {
        display: flex;
        flex-direction: column;
        justify-content: center;
        line-height: 1.2;
      }
      .vice-toggle {
        margin-top: 14px;
      }

      /* 整体按钮 */
      .vice-label {
        display: flex;
        align-items: center;
        justify-content: space-between;

        padding: 14px 18px;
        border-radius: 10px;
        background-color: #f8fafc;
        border: 1px solid #cbd5e1;

        font-size: 16px;
        font-weight: 600;
        cursor: pointer;

        transition: all 0.25s ease;
      }

      .vice-label:hover {
        background-color: #eef2f7;
        border-color: #94a3b8;
      }

      /* 左侧文字 */
      .vice-text {
        color: #334155;
      }

      /* 隐藏原生 checkbox */
      .vice-checkbox {
        display: none;
      }

      /* 自定义勾选框 */
      .vice-box {
        width: 26px;
        height: 26px;
        border-radius: 6px;

        border: 2px solid #94a3b8;
        background-color: white;

        position: relative;
        transition: all 0.2s ease;
      }

      /* 打勾状态 */
      .vice-checkbox:checked + .vice-box {
        background-color: #4a6fa5;
        border-color: #4a6fa5;
      }

      /* 勾号 */
      .vice-checkbox:checked + .vice-box::after {
        content: "";
        position: absolute;

        left: 7px;
        top: 3px;

        width: 6px;
        height: 12px;

        border: solid white;
        border-width: 0 3px 3px 0;
        transform: rotate(45deg);
      }
      .club-list-container {
        padding: 8px;
        border-radius: 10px;
        background-color: #f8fafc;
        border: 1px solid #e2e8f0;
      }
      .club-item {
        display: flex;
        align-items: center;
        gap: 12px;

        padding: 10px 12px;
        margin-bottom: 8px;

        border-radius: 10px;
        background-color: #ffffff;
        border: 1px solid #e5e7eb;

        cursor: pointer;
        transition: all 0.2s ease;
      }

      .club-item:last-child {
        margin-bottom: 0;
      }

      .club-item:hover {
        background-color: #f1f5f9;
        border-color: #cbd5e1;
      }
      .club-checkbox {
        display: none;
      }
      .club-checkbox:checked + .club-avatar + .club-text {
        color: #1e3a8a;
      }

      .club-checkbox:checked ~ * {
        font-weight: 600;
      }

      .club-checkbox:checked + .club-avatar {
        outline: 3px solid #4a6fa5;
      }
      .club-avatar {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        object-fit: cover;
        flex-shrink: 0;
      }
      .club-text {
        display: flex;
        flex-direction: column;
        line-height: 1.2;
      }

      .club-name-cn {
        font-size: 15px;
        color: #111827;
      }

      .club-name-en {
        font-size: 12px;
        color: #6b7280;
      }
    </style>
  </head>

  <body>
    <div class="login-container">
      <h1>登录 / 注册</h1>
      <div class="row">
        <input id="name" type="text" placeholder="中文名" />
        <input id="nameEn" type="text" placeholder="英文名" />
      </div>
      <input id="email" type="email" placeholder="邮箱" />
      <input id="password" type="password" placeholder="密码" />
      <select id="role" onchange="onRoleChange()">
        <option value="" disabled selected>请选择身份</option>
        <option value="teacher">老师</option>
        <option value="student">学生</option>
      </select>

      <!-- 下面是隐藏区域 -->
      <div id="dynamic-area"></div>

      <button class="submit-btn" onclick="validateForm()">提交</button>
    </div>

    <script>
      function validateForm() {
        const email = document.getElementById("email").value;

        if (!email.includes("@") || !email.endsWith("shwfl.edu.cn")) {
          alert("请输入有效的邮箱地址（必须包含 @ 和以 shwfl.edu.cn 结尾）");
          return;
        }

        sendPost();
      }

      function getValue(id) {
        const el = document.getElementById(id);
        if (!el) return null;

        if (el.type === "checkbox") {
          return el.checked;
        }

        return el.value;
      }

      function getFormDataByRole(role) {
        if (role === "teacher") {
          const responsibleClubIds = getSelectedClubIds("负责的社团（可多选）");
          console.log(responsibleClubIds);
          return {
            teacherName: getValue("name"),
            teacherNameEn: getValue("nameEn"),
            teacherPassword: getValue("password"),
            teacherEmail: getValue("email"),
            clubs: responsibleClubIds,
            userType: "teacher",
          };
        }

        if (role === "user") {
          return {
            username: getValue("name"),
            usernameEn: getValue("nameEn"),
            password: getValue("password"),
            email: getValue("email"),
            userType: "user",
          };
        }
      }

      function getSelectedClubIds(title) {
        return [
          ...document.querySelectorAll(`input[name="${title}"]:checked`),
        ].map((i) => Number(i.value));
      }

      function sendPost() {
        const role = document.getElementById("role").value;
        console.log("role: " + role);
        const json = getFormDataByRole(role);
        console.log(JSON.stringify(json, null, 2));

        fetch("/api/user/add/" + role, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(json),
        })
          .then((res) => res.json())
          .then((data) => {
            console.log("返回：", data);
            alert(data.message);
          })
          .catch((err) => console.error(err.message));
      }
    </script>

    <!-- 粒子背景效果 -->
    <div id="particles-container"></div>

    <script>
      // 创建粒子效果
      function createParticles() {
        const container = document.getElementById('particles-container');
        const particleCount = 50;

        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.style.position = 'absolute';
          particle.style.width = Math.random() * 6 + 2 + 'px';
          particle.style.height = particle.style.width;
          particle.style.background = 'rgba(255, 255, 255, 0.6)';
          particle.style.borderRadius = '50%';
          particle.style.top = Math.random() * 100 + '%';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.opacity = Math.random() * 0.5 + 0.3;
          particle.style.pointerEvents = 'none';
          particle.style.zIndex = '0';

          // 添加浮动动画
          const duration = Math.random() * 20 + 10;
          const delay = Math.random() * 5;
          const direction = Math.random() > 0.5 ? 1 : -1;

          particle.style.animation = `float ${duration}s ease-in-out infinite ${delay}s`;

          container.appendChild(particle);
        }
      }

      // 添加CSS动画
      const style = document.createElement('style');
      style.textContent = `
        @keyframes float {
          0%, 100% {
            transform: translateY(0) translateX(0);
            opacity: 0.3;
          }
          25% {
            transform: translateY(-20px) translateX(${Math.random() * 10 - 5}px);
            opacity: 0.6;
          }
          50% {
            transform: translateY(-10px) translateX(${Math.random() * 10 - 5}px);
            opacity: 0.8;
          }
          75% {
            transform: translateY(-15px) translateX(${Math.random() * 10 - 5}px);
            opacity: 0.5;
          }
        }

        #particles-container {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          overflow: hidden;
          z-index: 0;
        }
      `;
      document.head.appendChild(style);

      // 初始化粒子效果
      document.addEventListener('DOMContentLoaded', createParticles);
    </script>

    <script type="module">
      // 点击选项显示社团列表（可单选 or 多选）
      function onRoleChange() {
        const role = document.getElementById("role").value;
        const area = document.getElementById("dynamic-area");
        area.innerHTML = ""; // 清空
        if (role === "teacher") {
          area.appendChild(createClubButton("负责的社团（可多选）", true));
        }
      }
      window.onRoleChange = onRoleChange;

      /** 创建带 club 列表的卡片 */
      function createClubButton(title, multiple) {
        const container = document.createElement("div");

        const btn = document.createElement("button");
        btn.textContent = title;
        btn.style.marginBottom = "5px";
        btn.className = "club-select-btn";
        btn.addEventListener("click", () => {
          listDiv.style.display =
            listDiv.style.display === "block" ? "none" : "block";
        });
        container.appendChild(btn);

        const listDiv = document.createElement("div");
        listDiv.className = "club-list-container";
        listDiv.style.display = "none";
        listDiv.style.border = "1px solid #ccc";
        listDiv.style.padding = "5px";
        listDiv.style.marginBottom = "10px";

        fetch(`/api/club/all`)
          .then((j) => j.json())
          .then((result) => {
            const clubs = result.data;
            console.log(clubs);
            clubs.forEach((c) => {
              const item = document.createElement("label");
              item.className = "club-item";

              const input = document.createElement("input");
              input.className = "club-checkbox";
              input.type = multiple ? "checkbox" : "radio";
              input.name = title;
              input.value = c.id;

              const img = document.createElement("img");
              img.src = c.clubItem;
              img.className = "club-avatar";

              const textDiv = document.createElement("div");
              textDiv.className = "club-text";

              const cn = document.createElement("div");
              cn.className = "club-name-cn";
              cn.textContent = c.clubName;

              const en = document.createElement("div");
              en.className = "club-name-en";
              en.textContent = c.clubNameEn;

              textDiv.appendChild(cn);
              textDiv.appendChild(en);

              item.appendChild(input);
              item.appendChild(img);
              item.appendChild(textDiv);
              listDiv.appendChild(item);
            });
          });

        container.appendChild(listDiv);
        return container;
      }
    </script>
  </body>
</html>